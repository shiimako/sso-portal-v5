{{define "content"}}
<div class="max-w-6xl mx-auto" x-data="logViewer()">
    
    <div class="mb-4">
        <a href="/admin/dashboard" class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 transition text-sm font-medium">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Kembali ke Dashboard Admin
        </a>
    </div>

    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b border-gray-200 pb-4">
        <div>
            <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                <div class="p-2 bg-gray-100 rounded-lg">
                    <i data-lucide="history" class="w-5 h-5 text-gray-700"></i>
                </div>
                Riwayat Sinkronisasi
            </h3>
            <p class="text-gray-500 text-sm mt-1 ml-1">Total {{.Data.TotalData}} aktivitas tercatat.</p>
        </div>
    </div>

    <div class="flex flex-col sm:flex-row gap-4 w-full bg-gray-50 p-4 rounded-xl border border-gray-100 mt-6">
        <div class="flex-1 flex items-center gap-2 text-sm text-gray-600">
            <i data-lucide="filter" class="w-4 h-4"></i>
            <span>Filter berdasarkan Modul:</span>
        </div>
        
        <form method="GET" action="/admin/sync-logs" class="w-full sm:w-64">
            <select name="module" onchange="this.form.submit()" 
                    class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-gray-500 outline-none text-sm cursor-pointer">
                <option value="">Semua Modul</option>
                <option value="USER" {{if eq .Data.Module "USER"}}selected{{end}}>User</option>
                <option value="JURUSAN" {{if eq .Data.Module "JURUSAN"}}selected{{end}}>Jurusan</option>
                <option value="PRODI" {{if eq .Data.Module "PRODI"}}selected{{end}}>Prodi</option>
                <option value="JABATAN" {{if eq .Data.Module "JABATAN"}}selected{{end}}>Jabatan</option>
                <option value="ROLE" {{if eq .Data.Module "ROLE"}}selected{{end}}>Role</option>
            </select>
        </form>
    </div>

    <div class="bg-white shadow-sm rounded-xl overflow-hidden border border-gray-200 mt-4">
        <table class="w-full text-sm text-left">
            <thead class="bg-gray-50 text-gray-700 border-b">
                <tr>
                    <th class="px-6 py-3 font-semibold w-40 uppercase text-xs tracking-wider">Waktu</th>
                    <th class="px-6 py-3 font-semibold w-24 uppercase text-xs tracking-wider">Tipe</th>
                    <th class="px-6 py-3 font-semibold w-24 uppercase text-xs tracking-wider">Modul</th>
                    <th class="px-6 py-3 font-semibold w-32 uppercase text-xs tracking-wider">Status</th>
                    <th class="px-6 py-3 font-semibold uppercase text-xs tracking-wider">Pesan Ringkas</th>
                    <th class="px-6 py-3 font-semibold w-20 text-center uppercase text-xs tracking-wider">Detail</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                {{range .Data.Logs}}
                <tr class="hover:bg-gray-50 transition group">
                    <td class="px-6 py-4 whitespace-nowrap text-gray-500 font-mono text-xs">
                        {{.CreatedAt.Format "02/01/06 15:04:05"}}
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 rounded text-xs font-bold uppercase
                            {{if eq .Type "MANUAL"}}bg-blue-100 text-blue-700
                            {{else if eq .Type "CRON"}}bg-gray-100 text-gray-700
                            {{else}}bg-purple-100 text-purple-700{{end}}">
                            {{.Type}}
                        </span>
                    </td>
                    <td class="px-6 py-4 font-medium text-gray-900">{{.Module}}</td>
                    <td class="px-6 py-4">
                        {{if eq .Status "SUCCESS"}}
                            <span class="inline-flex items-center gap-1 text-green-700 font-medium bg-green-50 px-2.5 py-0.5 rounded-full text-xs border border-green-200">
                                <i data-lucide="check-circle" class="w-3 h-3"></i> Sukses
                            </span>
                        {{else if eq .Status "ERROR"}}
                            <span class="inline-flex items-center gap-1 text-red-700 font-medium bg-red-50 px-2.5 py-0.5 rounded-full text-xs border border-red-200">
                                <i data-lucide="alert-circle" class="w-3 h-3"></i> Gagal
                            </span>
                        {{else}}
                            <span class="inline-flex items-center gap-1 text-yellow-700 font-medium bg-yellow-50 px-2.5 py-0.5 rounded-full text-xs border border-yellow-200">
                                <i data-lucide="loader" class="w-3 h-3 animate-spin"></i> Running
                            </span>
                        {{end}}
                    </td>
                    <td class="px-6 py-4 text-gray-600 max-w-xs truncate" title="{{.Message}}">
                        {{.Message}}
                    </td>
                    <td class="px-6 py-4 text-center relative group">
                        <div class="hidden-msg hidden">{{.Message}}</div>
                        <button 
                            @click="openDetail(
                                $el.parentElement.querySelector('.hidden-msg').innerText, 
                                '{{.Status}}', 
                                '{{.CreatedAt.Format "02 Jan 2006 15:04"}}'
                            )"
                            class="p-1.5 bg-white border border-gray-200 hover:border-indigo-300 text-gray-400 hover:text-indigo-600 rounded-lg transition shadow-sm"
                            title="Lihat Detail Log">
                            <i data-lucide="eye" class="w-4 h-4"></i>
                        </button>
                    </td>
                </tr>
                {{else}}
                <tr>
                    <td colspan="6" class="px-6 py-12 text-center text-gray-400 flex flex-col items-center gap-2">
                        <i data-lucide="inbox" class="w-8 h-8 text-gray-300"></i>
                        <span>Belum ada riwayat sinkronisasi.</span>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
        
    <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4 text-sm text-gray-600">
        <div class="flex items-center gap-2">
            <span>Halaman <b>{{.Data.CurrentPage}}</b> dari <b>{{.Data.TotalPages}}</b></span>
        </div>

        <div class="flex items-center gap-2">
            {{if gt .Data.CurrentPage 1}}
            <a href="?page={{.Data.PrevPage}}&module={{.Data.Module}}" class="px-3 py-1 border rounded hover:bg-gray-100 transition flex items-center gap-1">
                <i data-lucide="chevron-left" class="w-4 h-4"></i> Prev
            </a>
            {{else}}
            <button disabled class="px-3 py-1 border rounded opacity-50 cursor-not-allowed flex items-center gap-1">
                <i data-lucide="chevron-left" class="w-4 h-4"></i> Prev
            </button>
            {{end}}
            
            {{if lt .Data.CurrentPage .Data.TotalPages}}
            <a href="?page={{.Data.NextPage}}&module={{.Data.Module}}" class="px-3 py-1 border rounded hover:bg-gray-100 transition flex items-center gap-1">
                Next <i data-lucide="chevron-right" class="w-4 h-4"></i>
            </a>
            {{else}}
            <button disabled class="px-3 py-1 border rounded opacity-50 cursor-not-allowed flex items-center gap-1">
                Next <i data-lucide="chevron-right" class="w-4 h-4"></i>
            </button>
            {{end}}
        </div>
    </div>

    <div x-show="modalOpen" x-cloak 
         class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900/60 backdrop-blur-sm"
         x-transition.opacity>
        
        <div class="bg-white w-full max-w-4xl rounded-xl shadow-2xl border overflow-hidden transform transition-all"
             @click.outside="modalOpen = false"
             x-transition:enter="ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-y-4"
             x-transition:enter-end="opacity-100 translate-y-0">
            
            <div class="px-6 py-4 border-b flex justify-between items-center"
                 :class="activeStatus === 'ERROR' ? 'bg-red-50' : 'bg-gray-50'">
                <div>
                    <h3 class="font-bold text-gray-800 flex items-center gap-2">
                        <span x-text="activeStatus === 'ERROR' ? '❌ Detail Error' : '✅ Detail Log'"></span>
                    </h3>
                    <p class="text-xs text-gray-500 mt-1" x-text="activeDate"></p>
                </div>
                <button @click="modalOpen = false" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <div class="p-6 bg-slate-50">
                <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Pesan Lengkap:</label>
                <div class="relative group">
                    <pre class="w-full bg-slate-900 text-slate-300 text-xs font-mono p-4 rounded-lg overflow-x-auto whitespace-pre-wrap border border-slate-700 shadow-inner h-96 custom-scrollbar"
                         x-text="activeMessage"></pre>
                    
                    <button @click="navigator.clipboard.writeText(activeMessage); alert('Teks disalin!')" 
                            class="absolute top-2 right-2 bg-white/10 hover:bg-white/20 text-white p-1.5 rounded text-xs opacity-0 group-hover:opacity-100 transition">
                        <i data-lucide="copy" class="w-3 h-3"></i>
                    </button>
                </div>
            </div>

            <div class="px-6 py-4 bg-white border-t flex justify-end">
                <button @click="modalOpen = false" class="px-4 py-2 bg-gray-900 hover:bg-black text-white rounded-lg text-sm font-medium transition shadow-lg">
                    Tutup
                </button>
            </div>
        </div>
    </div>

</div>

<script>
    function logViewer() {
        return {
            modalOpen: false,
            activeMessage: '',
            activeStatus: '',
            activeDate: '',

            openDetail(msg, status, date) {
                this.activeMessage = msg;
                this.activeStatus = status;
                this.activeDate = date;
                this.modalOpen = true;
            }
        }
    }
</script>
{{end}}