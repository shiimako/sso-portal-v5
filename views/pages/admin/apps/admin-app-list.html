{{define "content"}}

{{if .Data.Flash}}
<div x-data="{ show: true }" 
     x-init="setTimeout(() => show = false, 4000)" 
     x-show="show"
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0 translate-y-2"
     x-transition:enter-end="opacity-100 translate-y-0"
     x-transition:leave="transition ease-in duration-300"
     x-transition:leave-start="opacity-100 translate-y-0"
     x-transition:leave-end="opacity-0 translate-y-2"
     class="fixed top-24 right-6 z-50 flex items-center gap-3 bg-emerald-500 text-white px-6 py-4 rounded-xl shadow-2xl shadow-emerald-500/20 border border-emerald-400/50"
     style="display: none;" 
>
    <div class="bg-white/20 p-2 rounded-full">
        <i data-lucide="check" class="w-5 h-5 text-white"></i>
    </div>
    
    <div>
        <h4 class="font-bold text-sm">Berhasil!</h4>
        <p class="text-xs text-emerald-50 opacity-90">{{.Data.Flash}}</p>
    </div>

    <button @click="show = false" class="ml-4 text-white/70 hover:text-white transition">
        <i data-lucide="x" class="w-4 h-4"></i>
    </button>
</div>
{{end}}

<div x-data="appList()" class="space-y-6">

  <div>
      <a href="/admin/dashboard" class="inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 transition text-sm font-medium">
          <i data-lucide="arrow-left" class="w-4 h-4"></i>
          Kembali ke Dashboard Admin
      </a>
  </div>

  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 border-b border-gray-200 pb-4">
    <div>
        <h3 class="text-xl font-bold text-gray-800 flex items-center gap-2">
            <div class="p-2 bg-slate-100 rounded-lg">
                <i data-lucide="app-window" class="w-5 h-5 text-slate-700"></i>
            </div>
            Manajemen Aplikasi
        </h3>
        <p class="text-gray-500 text-sm mt-1 ml-1">Atur daftar aplikasi klien yang terhubung.</p>
    </div>

    <div class="flex items-center gap-3">
        <a href="/admin/application/new" class="bg-slate-800 hover:bg-black text-white text-sm font-medium px-4 py-2 rounded-lg shadow-sm hover:shadow flex items-center gap-2 transition">
            <i data-lucide="plus-circle" class="w-4 h-4"></i>
            Aplikasi Baru
        </a>
    </div>
  </div>

  <div class="flex flex-col sm:flex-row gap-4 w-full bg-gray-50 p-4 rounded-xl border border-gray-100">
      <div class="relative flex-1">
          <i data-lucide="search" class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
          <input type="text" x-model="search" @keyup.enter="applySearch()" placeholder="Cari nama atau slug..." 
              class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-500 focus:border-slate-500 outline-none transition bg-white" />
      </div>
      <button @click="applySearch()" class="bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 px-5 py-2 rounded-lg font-medium flex items-center gap-2 transition shadow-sm">
          <i data-lucide="search" class="w-4 h-4"></i> Cari
      </button>
  </div>

  <div class="bg-white shadow-sm rounded-xl overflow-hidden border border-gray-200">
    <table class="w-full text-sm">
        <thead class="bg-gray-50 text-gray-700 border-b">
            <tr>
                <th class="px-6 py-3 text-left font-semibold uppercase text-xs tracking-wider">ID</th>
                <th class="px-6 py-3 text-left font-semibold uppercase text-xs tracking-wider">Nama Aplikasi</th>
                <th class="px-6 py-3 text-left font-semibold uppercase text-xs tracking-wider">Slug</th>
                <th class="px-6 py-3 text-left font-semibold uppercase text-xs tracking-wider">Target URL</th>
                <th class="px-6 py-3 text-left font-semibold uppercase text-xs tracking-wider">Kategori</th>
                <th class="px-6 py-3 text-right font-semibold uppercase text-xs tracking-wider">Aksi</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
            {{range .Data.Apps}}
            <tr class="hover:bg-gray-50 transition group">
                <td class="px-6 py-4 text-gray-500 font-mono text-xs">#{{.ID}}</td>
                <td class="px-6 py-4 font-medium text-gray-900">{{.Name}}</td>
                <td class="px-6 py-4">
                    <span class="bg-slate-100 text-slate-700 px-2 py-1 rounded text-xs border border-slate-200">{{.Slug}}</span>
                </td>
                <td class="px-6 py-4 text-blue-600 truncate max-w-xs">
                    <a href="{{.TargetURL}}" target="_blank" class="hover:underline flex items-center gap-1">
                        {{.TargetURL}} <i data-lucide="external-link" class="w-3 h-3"></i>
                    </a>
                </td>
                <td class="px-6 py-4 font-medium text-gray-900">{{.CategoryName}}</td>
                <td class="px-6 py-4 text-right">
                    <div class="flex justify-end gap-2">
                         <a href="/admin/application/detail/{{.ID}}" class="text-gray-500 hover:text-blue-600 p-1.5 border rounded-lg hover:bg-blue-50 transition" title="Detail">
                            <i data-lucide="info" class="w-4 h-4"></i>
                         </a>
                         <a href="/admin/application/edit/{{.ID}}" class="text-gray-500 hover:text-yellow-600 p-1.5 border rounded-lg hover:bg-yellow-50 transition" title="Edit">
                            <i data-lucide="pencil" class="w-4 h-4"></i>
                         </a>
                         <button @click="confirmDelete({{.ID}}, '{{.Name}}')" class="text-gray-500 hover:text-red-600 p-1.5 border rounded-lg hover:bg-red-50 transition" title="Hapus">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                         </button>
                    </div>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="5" class="px-6 py-12 text-center text-gray-400">
                    Data aplikasi tidak ditemukan.
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
  </div>
  
  <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4 text-sm text-gray-600">
    <div class="flex items-center gap-2">
        <span>Tampilkan</span>
        <select x-model="limit" @change="resetPageAndUpdate()" class="border border-gray-300 rounded px-2 py-1 bg-white focus:outline-none focus:ring-1 focus:ring-slate-500">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
        </select>
        <span>data per halaman</span>
    </div>

    <div class="flex items-center gap-2">
        <button @click="prevPage" :disabled="page <= 1" class="px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition">
            <i data-lucide="chevron-left" class="w-4 h-4"></i>
        </button>
        
        <div class="flex items-center gap-1">
            <span>Halaman</span>
            <input type="number" x-model.number="page" @change="updateURL()" class="w-12 text-center border rounded py-1 focus:ring-1 focus:ring-slate-500 outline-none font-bold text-gray-900">
        </div>

        <button @click="nextPage" class="px-3 py-1 border rounded hover:bg-gray-100 transition">
            <i data-lucide="chevron-right" class="w-4 h-4"></i>
        </button>
    </div>
  </div>

  <div x-show="modal" x-cloak class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50"
       x-transition:enter="transition ease-out duration-200"
       x-transition:enter-start="opacity-0 scale-95"
       x-transition:enter-end="opacity-100 scale-100">
    
    <div class="bg-white w-full max-w-md rounded-xl shadow-2xl p-6 border border-gray-100" @click.outside="modal=false">
        <div class="flex items-start gap-4">
            <div class="p-3 bg-red-100 text-red-600 rounded-full shrink-0">
                <i data-lucide="alert-octagon" class="w-6 h-6"></i>
            </div>
            <div>
                <h3 class="text-lg font-bold text-gray-900">Hapus Aplikasi?</h3>
                <p class="text-gray-500 text-sm mt-2 leading-relaxed">
                    Anda yakin ingin menghapus aplikasi <b x-text="deleteName"></b>? Tindakan ini tidak dapat dibatalkan.
                </p>
            </div>
        </div>
        
        <div class="mt-6 flex justify-end gap-3">
            <button @click="modal=false" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition">
                Batal
            </button>
            <form :action="deleteURL" method="POST">
                <button type="submit" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium shadow-sm transition flex items-center gap-2">
                    Ya, Hapus
                </button>
            </form>
        </div>
    </div>
  </div>

</div>

<script>
  function appList() {
    return {
      search: new URLSearchParams(window.location.search).get("q") || "",
      modal: false,
      deleteURL: "",
      deleteName: "",
      page: Number("{{.Data.Page}}"),
      limit: Number("{{.Data.Limit}}"),

      confirmDelete(id, name) {
        this.deleteURL = `/admin/application/delete/${id}`;
        this.deleteName = name;
        this.modal = true;
      },
      applySearch() { this.page = 1; this.updateURL(); },
      updateURL() {
        const params = new URLSearchParams();
        params.set("page", this.page);
        params.set("limit", this.limit);
        if (this.search) params.set("q", this.search);
        window.location.search = params.toString();
      },
      resetPageAndUpdate() { this.page = 1; this.updateURL(); },
      prevPage() { if (this.page > 1) { this.page--; this.updateURL(); } },
      nextPage() { this.page++; this.updateURL(); },
    };
  }
</script>
{{end}}